import{a as D}from"./chunk-FW3DR2M5.js";import{m as w,t as l}from"./chunk-PXWKRQ4T.js";import{a as $,b as S}from"./chunk-BFO4FPQV.js";import{$ as h,E as g,Z as C,a as m,b as v,ea as u,ja as f,k as p,ka as k,q as d,v as o}from"./chunk-WCZLKJAP.js";var x=(()=>{let r=class r{constructor(){this.http=k(S),this.nextPageToken=null,this.prevPageToken=null}getCardsData(t,e){let s="/api/search",i=new $().set("type","video").set("part","snippet").set("maxResults","20").set("q",t);return e&&(i=i.set("pageToken",e)),this.http.get(s,{params:i}).pipe(h(a=>{this.nextPageToken=a.nextPageToken||null,this.prevPageToken=a.prevPageToken||null}),o(a=>a.items))}getStatistics(t){let e="/api/videos",s=new $().set("id",t).set("part","snippet,statistics");return this.http.get(e,{params:s}).pipe(o(i=>i.items))}getCardsDataWithStatistics(t,e){return this.getCardsData(t,e).pipe(C(s=>{let i=s.map(a=>a.id.videoId).join(",");return this.getStatistics(i).pipe(o(a=>s.map(n=>v(m({},n),{statistics:a.find(P=>P.id===n.id.videoId)?.statistics}))))}))}getCardById(t){let e="/api/videos",s=new $().set("id",t).set("part","snippet,statistics");return this.http.get(e,{params:s}).pipe(o(i=>i.items[0]))}getNextPageToken(){return this.nextPageToken}getPrevPageToken(){return this.prevPageToken}};r.\u0275fac=function(e){return new(e||r)},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let c=r;return c})();var Q=(()=>{let r=class r{constructor(t,e){this.store=t,this.cardDataService=e,this.currentQuery="",this.filterWord$$=new p(""),this.cardsList$$=new p([]),this.isDateSortClick$$=new p(!1),this.isViewSortClick$$=new p(!1),this.currentFilterWord$=this.filterWord$$.asObservable(),this.currentCardList$=this.cardsList$$.asObservable(),this.store.select(D).subscribe(s=>{this.cardsList$$.next(s)})}updateFilterWord(t){this.filterWord$$.next(t)}updateDateSortClick(){this.isDateSortClick$$.next(!this.isDateSortClick$$.getValue()),this.sortCardsByDate()}updateViewSortClick(){this.isViewSortClick$$.next(!this.isViewSortClick$$.getValue()),this.sortCardsByViews()}searchCards(t){if(this.currentQuery=t,t.trim()===""){this.cardsList$$.next([]),this.store.dispatch(l({cards:[]}));return}this.cardDataService.getCardsDataWithStatistics(t).subscribe(e=>{this.cardsList$$.next(e),this.store.dispatch(l({cards:e}))})}loadNextPage(){let t=this.cardDataService.getNextPageToken();return t?this.cardDataService.getCardsDataWithStatistics(this.currentQuery,t).pipe(h(e=>{this.cardsList$$.next(e),this.store.dispatch(l({cards:e}))}),o(()=>!0),g(()=>d(!1))):d(!1)}loadPrevPage(){let t=this.cardDataService.getPrevPageToken();return t?this.cardDataService.getCardsDataWithStatistics(this.currentQuery,t).pipe(h(e=>{this.cardsList$$.next(e),this.store.dispatch(l({cards:e}))}),o(()=>!0),g(()=>d(!1))):d(!1)}sortCardsByDate(){let t=[...this.cardsList$$.getValue()],e=this.isDateSortClick$$.getValue();t.sort((s,i)=>{let a=new Date("snippet"in s?s.snippet.publishedAt:s.date).getTime(),n=new Date("snippet"in i?i.snippet.publishedAt:i.date).getTime();return e?a-n:n-a}),this.cardsList$$.next(t)}sortCardsByViews(){let t=[...this.cardsList$$.getValue()],e=this.isViewSortClick$$.getValue();t.sort((s,i)=>{let a="statistics"in s?parseInt(s.statistics?.viewCount||"0",10):0,n="statistics"in i?parseInt(i.statistics?.viewCount||"0",10):0;return e?a-n:n-a}),this.cardsList$$.next(t)}};r.\u0275fac=function(e){return new(e||r)(f(w),f(x))},r.\u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"});let c=r;return c})();export{x as a,Q as b};
